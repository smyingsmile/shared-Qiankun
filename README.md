# shared-Qiankun
微前端实战

## 写在前面
仅作 Demo 示例与技术交流, 请勿擅自商用

## 项目基本说明
主要使用 VUE(JS) + iview
主应用通信目前仅接通 mirco-vue-app


## 微前端
### 优势
每个项目结构小
更灵活
打包部署快
降低了主项目的复杂度, 优化了架构

### 劣势
维护成本高
切换成本高
项目整体复杂度更高
编码的时候会更复杂一些

[微前端的核心价值](https://www.yuque.com/kuitos/gky7yw/rhduwc)


**在具体实践中，衡量一个微前端方案是否是可利用的，需要满足以下几个条件：**
一是技术栈无关性，不仅指子应用之间使用多个不同的框架，也指在使用同一个框架时，有可能在一个长的时间跨度下，由于框架的不兼容的升级，导致应用被锁死的情况。
二是开发、发布及部署独立，要求子应用和主应用做到工程上的解耦和独立。
三是应用隔离的能力，是指需要考虑如何不干扰到原来子应用的开发模式和部署模式的情况下，做好运行时的样式隔离、JS 隔离以及异常隔离等。
以上几点是基于工程价值方面考虑的。此外，也需要动态组合的能力，是基于产品价值方面考虑的。


## SPA & MPA

***按架构类型区分，常规 web 应用的架构类型分为两种，一种是 MPA，另一种是 SPA。***
SPA 和 MPA 都是微前端方案的基础选型。
2017 年各云产品控制台架构调研，除了 google cloud 之外，大部分的云厂商都使用非传统意义的 MPA 架构。

MPA 的优点在于部署简单，具备独立开发和独立部署的特性；
缺点是完成一个任务要跳到多个控制台，并且每个控制台又是重复刷新的。

SPA 能极大保证多个任务之间串联的流畅性；
问题是通常一个 SPA 是一个技术栈的应用，很难共存多个技术栈方案的选型。

按运行时特性区分，微前端包含两个类别，一类是单实例，另一类是多实例。
单实例场景通常是一个页面级别的组合，例如一个运行时只有一个 App 被激活。
多实例场景像一个组件或者是容器级别的应用，运行时可以做到多个应用被同时激活。

[阿里云控制台](https://homenew.console.aliyun.com/)
（阿里云的页面也是这样，其主应用菜单点击后会进入对应的子应用菜单， 同时只支持访问一个子应用菜单，或可选则返回主应用菜单）


***微前端架构的核心诉求是实现能支持自由组合的微前端架构，将其他的 SPA 应用以及其他组件级别的应用自由的组合到平台中。
那么，如何选择 SPA 和 MPA 以及单实例和多实例？
我们是否能探索出一种方案，将 SPA 和 MPA 工程上的特点结合起来，同时兼顾多实例和单实例运行时的场景来实现?***

目前，我们已经知道比较好的微前端方案（将 SPA 和 MPA 工程上的特点结合起来）是：
**蚂蚁金服出的 qiankun**
[使用**umiJS**的**qiankun**框架](https://github.com/umijs/umi-plugin-qiankun/blob/master/README.md)

## 本项目考虑的关键点
### 主应用与子应用生命周期的关联
将普通的项目改造成 qiankun 主应用基座，需要进行**三步**操作：
1. 创建主应用即子应用容器 - 用于承载子应用，渲染显示子应用；
2. 注册子应用 - 设置子应用激活条件，子应用地址等等；
3. 启动 qiankun；

### 主应用和子应用的通信
我们的项目不需要大量的主应用与子应用通信，
如果有需要可以就使用官方提供的Action方式就可以：

qiankun 内部提供了 initGlobalState 方法用于注册 MicroAppStateActions 实例用于通信，
该实例有**三个**方法，分别是：

**1. setGlobalState：**

设置 globalState - 设置新的值时，内部将执行浅检查，
如果检查到 globalState 发生改变则触发通知，通知到所有的观察者函数。

**2. onGlobalStateChange：**

注册观察者函数 - 响应 globalState 变化，
在 globalState 发生改变时触发该观察者函数。

**3. offGlobalStateChange：**
取消观察者函数 - 该实例不再响应 globalState 变化。

## 参考链接: (倾情感谢---思否 id 晒兜斯作者提供了基本可以落地的 Demo 方案~)
[基于 qiankun 的微前端最佳实践（万字长文） - 从 0 到 1 篇](https://segmentfault.com/a/1190000022631614)

[基于 qiankun 的微前端最佳实践（图文并茂） - 应用间通信篇](https://segmentfault.com/a/1190000022583716)

[万字长文 + 图文并茂 + 全面解析微前端框架 qiankun 源码 - qiankun 篇](https://segmentfault.com/a/1190000022275991)

